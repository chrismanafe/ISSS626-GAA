<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christover Manafe">
<meta name="dcterms.date" content="2024-10-31">

<title>ISSS626-GAA - Take-home Exercise 3: Predicting HDB Resale Prices with Geographically Weighted Machine Learning Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex01/hands_on_ex01.1.html">
 <span class="dropdown-text">1a Geospatial Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex01/hands_on_ex01.2.html">
 <span class="dropdown-text">1b Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex02/hands_on_ex02.1.html">
 <span class="dropdown-text">2a 1st Order Spatial Point Patterns Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex02/hands_on_ex02.2.html">
 <span class="dropdown-text">2b 2nd Order Spatial Point Patterns Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex03/hands_on_ex03.html">
 <span class="dropdown-text">3 Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex04/hands_on_ex04.html">
 <span class="dropdown-text">4 Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex05/hands_on_ex05.1.html">
 <span class="dropdown-text">5a Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex05/hands_on_ex05.2.html">
 <span class="dropdown-text">5b Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex06/hands_on_ex06.html">
 <span class="dropdown-text">6 Geographical Segmentation with Spatially Constrained Clustering Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex07/hands_on_ex07.html">
 <span class="dropdown-text">7 Calibrating Hedonic Pricing Model for Private Highrise Property with GWR Method</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex08/hands_on_ex08.html">
 <span class="dropdown-text">8 Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex09/hands_on_ex09.html">
 <span class="dropdown-text">9 Modelling Geographical Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex10/hands_on_ex10a.html">
 <span class="dropdown-text">10a Processing and Visualising Flow Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../hands_on_ex/hands_on_ex10/hands_on_ex10b.html">
 <span class="dropdown-text">10b Calibrating Spatial Interaction Models with R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex01/in_class_ex01.html">
 <span class="dropdown-text">1 Geospatial Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex02/in_class_ex02.html">
 <span class="dropdown-text">2 Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex03/in_class_ex03.html">
 <span class="dropdown-text">3 Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex04/in_class_ex04.html">
 <span class="dropdown-text">4 Geographically Weighted Summary Statistics - GWmodel methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex05/in_class_ex05.html">
 <span class="dropdown-text">5 Global and Local Measures of Spatial Association: sfdep methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex06/in_class_ex06.html">
 <span class="dropdown-text">6 Emerging Hot Spot Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex07/in_class_ex07.html">
 <span class="dropdown-text">7 Calibrating Hedonic Pricing Model for Private Highrise Property with GWR Method</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex08/in_class_ex08.html">
 <span class="dropdown-text">8 Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex09/in_class_ex09.html">
 <span class="dropdown-text">9 Modelling Geographical Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../in_class_ex/in_class_ex10/in_class_ex10.html">
 <span class="dropdown-text">10 Spatial Interaction Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../take_home_ex/take_home_ex01/take_home_ex01.html">
 <span class="dropdown-text">1. Geospatial Analytics for Public Good</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take_home_ex/take_home_ex02/take_home_ex02.html">
 <span class="dropdown-text">2. Discovering impacts of COVID-19 on Thailand tourism economy at the province level using spatial and spatio-temporal statistics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../take_home_ex/take_home_ex03/take_home_ex03.html">
 <span class="dropdown-text">3. Predicting HDB Resale Prices with Geographically Weighted Machine Learning Methods</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/chrismanafe/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chrismanafe"> <i class="bi bi-github" role="img" aria-label="Github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#the-objective" id="toc-the-objective" class="nav-link" data-scroll-target="#the-objective"><span class="header-section-number">2</span> The Objective</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started"><span class="header-section-number">3</span> Getting Started</a>
  <ul class="collapse">
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data"><span class="header-section-number">3.1</span> The Data</a></li>
  <li><a href="#the-packages" id="toc-the-packages" class="nav-link" data-scroll-target="#the-packages"><span class="header-section-number">3.2</span> The Packages</a></li>
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import"><span class="header-section-number">3.3</span> Data Import</a>
  <ul class="collapse">
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data"><span class="header-section-number">3.3.1</span> Geospatial Data</a></li>
  <li><a href="#aspatial-data" id="toc-aspatial-data" class="nav-link" data-scroll-target="#aspatial-data"><span class="header-section-number">3.3.2</span> Aspatial Data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing"><span class="header-section-number">4</span> Data Pre-processing</a>
  <ul class="collapse">
  <li><a href="#z-dimensions-removal" id="toc-z-dimensions-removal" class="nav-link" data-scroll-target="#z-dimensions-removal"><span class="header-section-number">4.1</span> Z-Dimensions Removal</a></li>
  <li><a href="#drop-unnecessary-columns" id="toc-drop-unnecessary-columns" class="nav-link" data-scroll-target="#drop-unnecessary-columns"><span class="header-section-number">4.2</span> Drop Unnecessary Columns</a></li>
  <li><a href="#check-invalid-geometries" id="toc-check-invalid-geometries" class="nav-link" data-scroll-target="#check-invalid-geometries"><span class="header-section-number">4.3</span> Check Invalid Geometries</a></li>
  </ul></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization"><span class="header-section-number">5</span> Data Visualization</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">6</span> Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#structural-factors" id="toc-structural-factors" class="nav-link" data-scroll-target="#structural-factors"><span class="header-section-number">6.1</span> Structural Factors</a>
  <ul class="collapse">
  <li><a href="#floor-level" id="toc-floor-level" class="nav-link" data-scroll-target="#floor-level"><span class="header-section-number">6.1.1</span> Floor Level</a></li>
  <li><a href="#remaining-lease-units-age" id="toc-remaining-lease-units-age" class="nav-link" data-scroll-target="#remaining-lease-units-age"><span class="header-section-number">6.1.2</span> Remaining Lease &amp; Unit’s Age</a></li>
  </ul></li>
  <li><a href="#locational-factors" id="toc-locational-factors" class="nav-link" data-scroll-target="#locational-factors"><span class="header-section-number">6.2</span> Locational Factors</a>
  <ul class="collapse">
  <li><a href="#proximity-calculation" id="toc-proximity-calculation" class="nav-link" data-scroll-target="#proximity-calculation"><span class="header-section-number">6.2.1</span> Proximity Calculation</a></li>
  <li><a href="#facility-count-within-radius-calculation" id="toc-facility-count-within-radius-calculation" class="nav-link" data-scroll-target="#facility-count-within-radius-calculation"><span class="header-section-number">6.2.2</span> Facility Count within Radius Calculation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">7</span> Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#resale-price" id="toc-resale-price" class="nav-link" data-scroll-target="#resale-price"><span class="header-section-number">7.1</span> Resale Price</a></li>
  <li><a href="#locational-factors-1" id="toc-locational-factors-1" class="nav-link" data-scroll-target="#locational-factors-1"><span class="header-section-number">7.2</span> Locational Factors</a></li>
  <li><a href="#structural-factors-1" id="toc-structural-factors-1" class="nav-link" data-scroll-target="#structural-factors-1"><span class="header-section-number">7.3</span> Structural Factors</a></li>
  <li><a href="#multicollinearity-analysis" id="toc-multicollinearity-analysis" class="nav-link" data-scroll-target="#multicollinearity-analysis"><span class="header-section-number">7.4</span> Multicollinearity Analysis</a></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"><span class="header-section-number">8</span> Multiple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#prepare-train-and-test-data" id="toc-prepare-train-and-test-data" class="nav-link" data-scroll-target="#prepare-train-and-test-data"><span class="header-section-number">8.1</span> Prepare Train and Test Data</a></li>
  <li><a href="#calibrate-multiple-linear-regression-model" id="toc-calibrate-multiple-linear-regression-model" class="nav-link" data-scroll-target="#calibrate-multiple-linear-regression-model"><span class="header-section-number">8.2</span> Calibrate Multiple Linear Regression Model</a></li>
  <li><a href="#multicollinearity-check" id="toc-multicollinearity-check" class="nav-link" data-scroll-target="#multicollinearity-check"><span class="header-section-number">8.3</span> Multicollinearity Check</a></li>
  <li><a href="#test-for-non-linearity" id="toc-test-for-non-linearity" class="nav-link" data-scroll-target="#test-for-non-linearity"><span class="header-section-number">8.4</span> Test for Non-Linearity</a></li>
  <li><a href="#test-for-normality" id="toc-test-for-normality" class="nav-link" data-scroll-target="#test-for-normality"><span class="header-section-number">8.5</span> Test for Normality</a></li>
  <li><a href="#test-for-spatial-autocorrelation" id="toc-test-for-spatial-autocorrelation" class="nav-link" data-scroll-target="#test-for-spatial-autocorrelation"><span class="header-section-number">8.6</span> Test for Spatial Autocorrelation</a></li>
  </ul></li>
  <li><a href="#geographically-weighted-random-forest" id="toc-geographically-weighted-random-forest" class="nav-link" data-scroll-target="#geographically-weighted-random-forest"><span class="header-section-number">9</span> Geographically Weighted Random Forest</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">9.1</span> Data Preparation</a></li>
  <li><a href="#compute-optimum-bandwidth" id="toc-compute-optimum-bandwidth" class="nav-link" data-scroll-target="#compute-optimum-bandwidth"><span class="header-section-number">9.2</span> Compute Optimum Bandwidth</a></li>
  <li><a href="#calibrate-geographically-weighted-random-forest-model" id="toc-calibrate-geographically-weighted-random-forest-model" class="nav-link" data-scroll-target="#calibrate-geographically-weighted-random-forest-model"><span class="header-section-number">9.3</span> Calibrate Geographically Weighted Random Forest Model</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation"><span class="header-section-number">10</span> Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#prepare-test-data" id="toc-prepare-test-data" class="nav-link" data-scroll-target="#prepare-test-data"><span class="header-section-number">10.1</span> Prepare Test Data</a></li>
  <li><a href="#model-predictions-on-test-data" id="toc-model-predictions-on-test-data" class="nav-link" data-scroll-target="#model-predictions-on-test-data"><span class="header-section-number">10.2</span> Model Predictions on Test Data</a>
  <ul class="collapse">
  <li><a href="#multiple-linear-regression-1" id="toc-multiple-linear-regression-1" class="nav-link" data-scroll-target="#multiple-linear-regression-1"><span class="header-section-number">10.2.1</span> Multiple Linear Regression</a></li>
  <li><a href="#geographically-weighted-random-forest-1" id="toc-geographically-weighted-random-forest-1" class="nav-link" data-scroll-target="#geographically-weighted-random-forest-1"><span class="header-section-number">10.2.2</span> Geographically Weighted Random Forest</a></li>
  </ul></li>
  <li><a href="#calculate-root-mean-square-error-rmse" id="toc-calculate-root-mean-square-error-rmse" class="nav-link" data-scroll-target="#calculate-root-mean-square-error-rmse"><span class="header-section-number">10.3</span> Calculate Root Mean Square Error (RMSE)</a></li>
  <li><a href="#model-predictions-visualization" id="toc-model-predictions-visualization" class="nav-link" data-scroll-target="#model-predictions-visualization"><span class="header-section-number">10.4</span> Model Predictions Visualization</a></li>
  <li><a href="#visualization-of-model-residuals" id="toc-visualization-of-model-residuals" class="nav-link" data-scroll-target="#visualization-of-model-residuals"><span class="header-section-number">10.5</span> Visualization of Model Residuals</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11</span> Conclusion</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">12</span> Reference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3: Predicting HDB Resale Prices with Geographically Weighted Machine Learning Methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christover Manafe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 9, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<p>Housing is an essential component of household wealth worldwide. For most people, buying a home represents one of the largest investments they will make. Housing prices are influenced by a range of factors, some of which are global—such as a country’s economic conditions or inflation rate—while others are specific to individual properties. These factors can be divided into structural and locational categories. Structural factors relate directly to the property itself, including its size, fittings, and tenure. Locational factors, on the other hand, concern the property’s surroundings, such as proximity to childcare centers, public transportation, and shopping centers.</p>
<p>In Singapore, public housing plays a unique and essential role. With over one million flats spanning 24 towns and three estates, the Singapore brand of public housing is uniquely different. These flats are home to more than 80% of Singapore’s resident population, with about 90% of them owning their homes.</p>
<p>Housing prices are influenced by a range of factors, such as amenities and accessibility. In Singapore, HDB flats near MRT stations, bus interchanges, shopping centers, and schools often command higher values due to their convenience. Economic conditions also play a role; when the economy is strong and interest rates are low, buyers have more purchasing power, which increases demand and can drive prices up. Additionally, flat attributes such as size, layout, and lease tenure affect prices, with larger flats or those with longer remaining leases generally being more valuable.</p>
</section>
<section id="the-objective" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The Objective</h1>
<p>In this exercise, we will build and calibrate a predictive model to estimate HDB resale prices for the period of July to September 2024, using HDB resale transaction records from 2023.</p>
</section>
<section id="getting-started" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Getting Started</h1>
<section id="the-data" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-data"><span class="header-section-number">3.1</span> The Data</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Dataset Name</strong></th>
<th><strong>Description</strong></th>
<th><strong>Format</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Master Plan 2019 Subzone Boundary</td>
<td>Geospatial data representing the boundaries of different areas in Singapore, specifically at the planning subzone level.</td>
<td><p>ESRI Shapefile</p>
<p><a href="https://data.gov.sg/datasets?query=Master+Plan+subzone+boundary&amp;page=1&amp;resultId=d_8594ae9ff96d0c708bc2af633048edfb">Source</a></p></td>
</tr>
<tr class="even">
<td>HDB Resale data</td>
<td>Aspatial data containing HDB resale transacted prices in Singapore from Jan 2017 onwards.</td>
<td><p>CSV</p>
<p><a href="https://data.gov.sg/datasets?query=hdb+resale&amp;page=1&amp;resultId=d_8b84c4ee58e3cfc0ece0d773c8ca6abc">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of eldercare in Singapore</td>
<td>Geospatial data containing list of eldercare locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=eldercare&amp;page=1&amp;resultId=d_3545b068e3f3506c56b2cb6b6117b884">Source</a></p></td>
</tr>
<tr class="even">
<td>List of hawker centres in Singapore</td>
<td>Geospatial data containing list of hawker centres locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=hawker+centre&amp;page=1&amp;resultId=d_4a086da0a5553be1d89383cd90d07ecd">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of parks in Singapore</td>
<td>Geospatial data containing list of parks locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=parks&amp;page=1&amp;resultId=d_0542d48f0991541706b58059381a6eca">Source</a></p></td>
</tr>
<tr class="even">
<td>List of supermarkets in Singapore</td>
<td>Geospatial data containing list of supermarkets locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=supermarket&amp;page=1&amp;resultId=d_cac2c32f01960a3ad7202a99c27268a0">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of CHAS clinics in Singapore</td>
<td>Geospatial data containing list of CHAS clinics locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=chas+clinics&amp;page=1&amp;resultId=d_548c33ea2d99e29ec63a7cc9edcccedc">Source</a></p></td>
</tr>
<tr class="even">
<td>List of kindergartens in Singapore</td>
<td>Geospatial data containing list of kindergartens locations in Singapore.</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=childcare+services&amp;page=1&amp;resultId=d_5d668e3f544335f8028f546827b773b4">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of supermarkets in Singapore</td>
<td>Geospatial data containing list of supermarket locations in Singapore</td>
<td><p>geojson</p>
<p><a href="https://data.gov.sg/datasets?query=supermarket&amp;page=1&amp;resultId=d_cac2c32f01960a3ad7202a99c27268a0">Source</a></p></td>
</tr>
<tr class="even">
<td>List of MRT/LRT stations in Singapore</td>
<td>Geospatial data containing list of MRT/LRT stations locations in Singapore.</td>
<td><p>ESRI Shapefile</p>
<p><a href="https://datamall.lta.gov.sg/content/datamall/en/static-data.html">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of bus stops in Singapore</td>
<td>Geospatial data containing list of eldercare in Singapore.</td>
<td><p>ESRI Shapefile</p>
<p><a href="https://datamall.lta.gov.sg/content/datamall/en/static-data.html">Source</a></p></td>
</tr>
<tr class="even">
<td>List of primary school in Singapore</td>
<td>Aspatial data containing list of primary schools in Singapore.</td>
<td><p>CSV</p>
<p><a href="https://data.gov.sg/datasets?query=primary+school&amp;page=1&amp;resultId=d_688b934f82c1059ed0a6993d2a829089">Source</a></p></td>
</tr>
<tr class="odd">
<td>CBD coordinates</td>
<td>Coordinate of Raffles Place MRT</td>
<td></td>
</tr>
<tr class="even">
<td>List of shopping malls in Singapore</td>
<td>Aspatial data containing list of shopping malls in Singapore.</td>
<td><p>CSV</p>
<p>Updated manually from <a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">Source</a> with latest data.</p></td>
</tr>
<tr class="odd">
<td>List of primary schools in Singapore</td>
<td>Aspatial data containing list of primary schools in Singapore</td>
<td><p>JSON</p>
<p><a href="https://www.moe.gov.sg/schoolfinder?journey=Primary%20school">MOE</a></p></td>
</tr>
<tr class="even">
<td>Good primary schools</td>
<td>Aspatial data containing list of top 20 primary schools from <a href="https://schlah.com/" class="uri">https://schlah.com/</a>.</td>
<td><p>CSV</p>
<p><a href="https://schlah.com/primary-schools">Source</a></p></td>
</tr>
<tr class="odd">
<td>List of hospitals in Singapore</td>
<td>Aspatial data containing list of hospitals in Singapore</td>
<td><p>CSV</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_hospitals_in_Singapore">Source</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="the-packages" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-packages"><span class="header-section-number">3.2</span> The Packages</h2>
<p>We will use following packages in this exercise</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Packages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>We will use following packages in this exercise:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://r-spatial.github.io/sf/"><strong>sf</strong></a></td>
<td>Provides functions to manage, process, and manipulate <strong>Simple Features</strong>, a formal geospatial data standard that specifies a storage and access model of spatial geometries such as points, lines, and polygons.</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/sp/index.html"><strong>sp</strong></a></td>
<td>Provides classes and methods for Spatial Data.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/spdep/"><strong>spdep</strong></a></td>
<td>Provides a collection of functions to create spatial weights matrix objects from polygon ‘contiguities’, point patterns by distance, and tessellations.</td>
</tr>
<tr class="even">
<td><a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a></td>
<td>A collection of R packages for data science tasks such as importing, tidying, wrangling, and visualizing data.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/tmap/"><strong>tmap</strong></a></td>
<td>Provides functions for creating cartographic-quality static maps or interactive maps using the <a href="https://leafletjs.com/">leaflet</a> API.</td>
</tr>
<tr class="even">
<td><a href="https://olsrr.rsquaredacademy.com/"><strong>olsrr</strong></a></td>
<td>A package for building OLS models and performing diagnostic tests.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/SpatialML/"><strong>SpatialML</strong></a></td>
<td>A package that implements a spatial extension of the random forest algorithm.</td>
</tr>
<tr class="even">
<td><a href="https://rsample.tidymodels.org/"><strong>rsample</strong></a></td>
<td>A package that provides functions to create different types of resamples and corresponding classes for their analysis.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/mfrasco/Metrics"><strong>Metrics</strong></a></td>
<td>A package for common machine learning metrics.</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/httr/index.html"><strong>httr</strong></a></td>
<td>A package that provides tools for working with URLs and HTTP</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/jsonlite/index.html"><strong>jsonlite</strong></a></td>
<td>A simple and robust JSON parser and generator for R</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/units/index.html"><strong>units</strong></a></td>
<td>A package that provides tools to handle and convert measurement units for numeric values.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/matrixStats/index.html"><strong>matrixStats</strong></a></td>
<td>A package that provides optimized functions for common matrix and vector operations.</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html"><strong>corrplot</strong></a></td>
<td>A package that provides a visual exploratory tool on correlation matrix.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/ggpubr/index.html"><strong>ggpubr</strong></a></td>
<td>A package that provides easy-to-use functions for creating and arranging <code>ggplot2</code> plots.</td>
</tr>
<tr class="even">
<td><a href="https://cran.r-project.org/web/packages/ggstatsplot/index.html"><strong>ggstatsplot</strong></a></td>
<td>Provides functions to creates graphics with details from statistical tests included in the plots themselves.</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/GWmodel/index.html"><strong>GWmodel</strong></a></td>
<td>A package for calibrating the geographically weighted family of models.</td>
</tr>
</tbody>
</table>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>To install and launch all R packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, sp, spdep, olsrr, SpatialML, tmap, rsample, Metrics, tidyverse, httr, jsonlite, units, matrixStats, corrplot, ggpubr, ggstatsplot, GWmodel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="data-import" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="data-import"><span class="header-section-number">3.3</span> Data Import</h2>
<section id="geospatial-data" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="geospatial-data"><span class="header-section-number">3.3.1</span> Geospatial Data</h3>
<p>Let’s import all geospatial dataset into the R environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"MPSZ-2019"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MPSZ-2019' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpsz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM
First 10 features:
                 SUBZONE_N SUBZONE_C       PLN_AREA_N PLN_AREA_C       REGION_N
1              MARINA EAST    MESZ01      MARINA EAST         ME CENTRAL REGION
2         INSTITUTION HILL    RVSZ05     RIVER VALLEY         RV CENTRAL REGION
3           ROBERTSON QUAY    SRSZ01  SINGAPORE RIVER         SR CENTRAL REGION
4  JURONG ISLAND AND BUKOM    WISZ01  WESTERN ISLANDS         WI    WEST REGION
5             FORT CANNING    MUSZ02           MUSEUM         MU CENTRAL REGION
6         MARINA EAST (MP)    MPSZ05    MARINE PARADE         MP CENTRAL REGION
7                   SUDONG    WISZ03  WESTERN ISLANDS         WI    WEST REGION
8                  SEMAKAU    WISZ02  WESTERN ISLANDS         WI    WEST REGION
9           SOUTHERN GROUP    SISZ02 SOUTHERN ISLANDS         SI CENTRAL REGION
10                 SENTOSA    SISZ01 SOUTHERN ISLANDS         SI CENTRAL REGION
   REGION_C                       geometry
1        CR MULTIPOLYGON (((33222.98 29...
2        CR MULTIPOLYGON (((28481.45 30...
3        CR MULTIPOLYGON (((28087.34 30...
4        WR MULTIPOLYGON (((14557.7 304...
5        CR MULTIPOLYGON (((29542.53 31...
6        CR MULTIPOLYGON (((35279.55 30...
7        WR MULTIPOLYGON (((15772.59 21...
8        WR MULTIPOLYGON (((19843.41 21...
9        CR MULTIPOLYGON (((30870.53 22...
10       CR MULTIPOLYGON (((26879.04 26...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"ELDERCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ELDERCARE' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 133 features and 18 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 14481.92 ymin: 28218.43 xmax: 41665.14 ymax: 46804.9
Projected CRS: SVY21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>chas <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/CHASClinics.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CHASClinics' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/CHASClinics.geojson' 
  using driver `GeoJSON'
Simple feature collection with 1193 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.5818 ymin: 1.016264 xmax: 103.9903 ymax: 1.456037
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>childcare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/ChildCareServices.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ChildCareServices' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/ChildCareServices.geojson' 
  using driver `GeoJSON'
Simple feature collection with 1925 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>kindergartens <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Kindergartens.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Kindergartens' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/Kindergartens.geojson' 
  using driver `GeoJSON'
Simple feature collection with 448 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6887 ymin: 1.247759 xmax: 103.9717 ymax: 1.455452
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>hawker_center <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/HawkerCentresGEOJSON.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `HawkerCentresGEOJSON' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/HawkerCentresGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 125 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6974 ymin: 1.272716 xmax: 103.9882 ymax: 1.449017
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/Parks.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Parks' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/Parks.geojson' 
  using driver `GeoJSON'
Simple feature collection with 430 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6929 ymin: 1.214491 xmax: 104.0538 ymax: 1.462094
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"BusStop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">lengths</span>(<span class="fu">st_within</span>(., mpsz)) <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 5166 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48285.52 ymax: 52983.82
Projected CRS: SVY21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"RapidTransitSystemStation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STN_NAM_DE <span class="sc">!=</span> <span class="st">"BOCC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `RapidTransitSystemStation' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial' 
  using driver `ESRI Shapefile'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in CPL_read_ogr(dsn, layer, query, as.character(options), quiet, : GDAL
Message 1: Non closed ring detected. To avoid accepting it, set the
OGR_GEOMETRY_ACCEPT_UNCLOSED_RING configuration option to NO</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 230 features and 5 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 6068.209 ymin: 27478.44 xmax: 45377.5 ymax: 47913.58
Projected CRS: SVY21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>supermarkets <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/SupermarketsGEOJSON.geojson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SupermarketsGEOJSON' from data source 
  `/Users/cham/project/Geospatial-Analytics/chrismanafe/ISSS626-GAA/take_home_ex/take_home_ex03/data/geospatial/SupermarketsGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 526 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6258 ymin: 1.24715 xmax: 104.0036 ymax: 1.461526
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Notice that some of the data (e.g.&nbsp;chas, childcare) has its dimensions listed as ‘XYZ’, indicating a z-dimension, even though both zmin and zmax are set to 0. We’ll remove this dimension with <a href="https://r-spatial.github.io/sf/reference/st_zm.html">st_zm()</a> in our pre-processing.</p>
<p>We also filter bus stops points that are located outside of Singapore (e.g.&nbsp;in Johor Bahru Malaysia) using <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html">st_within()</a> function.</p>
<p>Although the LTA Data Mall describes the train station data as points, it is actually in polygon format. We’ll address this in our pre-processing steps. Additionally, we’re excluding <code>BOCC</code> as it is not an MRT/LRT station.</p>
</blockquote>
</section>
<section id="aspatial-data" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="aspatial-data"><span class="header-section-number">3.3.2</span> Aspatial Data</h3>
<p>Most of our aspatial dataset lacks geocoding information. To address this, we’ll use the following function provided by Prof.&nbsp;Kam, which sends an HTTP request to the OneMap API to retrieve geocoding data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(add_list){</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://www.onemap.gov.sg/api/common/elastic/search?'</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> postal, </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> lat, </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> lng)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>                                <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>                              <span class="at">postal =</span> postal, </span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>                              <span class="at">latitude =</span> lat, </span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>                              <span class="at">longitude =</span> lng)</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="primary-schools-in-singapore" class="level4" data-number="3.3.2.1">
<h4 data-number="3.3.2.1" class="anchored" data-anchor-id="primary-schools-in-singapore"><span class="header-section-number">3.3.2.1</span> Primary Schools in Singapore</h4>
<p>Currently, there is no single source providing downloadable data on primary schools from platforms like <a href="https://data.gov.sg/">data.gov.sg</a>, <a href="https://www.moe.gov.sg/schoolfinder?journey=Primary%20school">MOE</a>, or the <a href="https://www.onemap.gov.sg/apidocs/apidocs">OneMap API</a>. However, by querying the response from <a href="https://www.onemap.gov.sg/#/SchoolQueryInfo">OneMap’s SchoolQueryInfo</a>, we can download the JSON response and read it into R as an <code>sf</code> data frame.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/onemap_schoolQuery.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="913"></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pri_schools <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"data/aspatial/onemap_prischools.json"</span>)<span class="sc">$</span>SearchResults <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(SCHOOLNAME, POSTAL_CODE, LATITUDE, LONGITUDE)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>pri_schools <span class="ot">&lt;-</span> pri_schools[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pri_schools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 180
Columns: 4
$ SCHOOLNAME  &lt;chr&gt; "ADMIRALTY PRIMARY SCHOOL", "AHMAD IBRAHIM PRIMARY SCHOOL"…
$ POSTAL_CODE &lt;chr&gt; "738907", "768643", "579646", "159016", "544969", "569785"…
$ LATITUDE    &lt;chr&gt; "1.44304273982377", "1.43373998459719", "1.36065643548317"…
$ LONGITUDE   &lt;chr&gt; "103.800272823634", "103.832709401734", "103.832931644894"…</code></pre>
</div>
</div>
<p>The result contains data for 180 primary schools, missing two schools from the official MOE list, which can be found at <a href="https://www.moe.gov.sg/schoolfinder?journey=Primary%20school">MOE School Finder</a>. After a manual cross-check, we identified the missing schools as <code>Kranji Primary School</code> and <code>Pioneer Primary School</code>. Let’s add this one manually to the <code>pri_schools</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>missing_schools <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(<span class="fu">c</span>(<span class="st">"Kranji Primary School"</span>, <span class="st">"Pioneer Primary School"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SCHOOLNAME =</span> address, <span class="at">POSTAL_CODE =</span> postal, <span class="at">LATITUDE =</span> latitude, <span class="at">LONGITUDE =</span> longitude)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>missing_schools<span class="sc">$</span>SCHOOLNAME <span class="ot">&lt;-</span> <span class="fu">toupper</span>(missing_schools<span class="sc">$</span>SCHOOLNAME)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>primary_schools <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pri_schools, missing_schools)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(primary_schools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 182
Columns: 4
$ SCHOOLNAME  &lt;chr&gt; "ADMIRALTY PRIMARY SCHOOL", "AHMAD IBRAHIM PRIMARY SCHOOL"…
$ POSTAL_CODE &lt;chr&gt; "738907", "768643", "579646", "159016", "544969", "569785"…
$ LATITUDE    &lt;chr&gt; "1.44304273982377", "1.43373998459719", "1.36065643548317"…
$ LONGITUDE   &lt;chr&gt; "103.800272823634", "103.832709401734", "103.832931644894"…</code></pre>
</div>
</div>
<p>Let’s convert the <code>primary_schools</code> data frame into an <code>sf</code> data frame using longitude and latitude coordinates, and project it to CRS 3414. We’ll then save it as an RDS file for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(primary_schools, <span class="at">coords=</span><span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(primary_schools_sf, <span class="st">"data/rds/primary_schools_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/primary_schools_sf.rds"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>primary_schools_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 182 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11777.9 ymin: 28588.52 xmax: 42431.84 ymax: 48729.52
Projected CRS: SVY21 / Singapore TM
First 10 features:
                       SCHOOLNAME POSTAL_CODE                  geometry
1        ADMIRALTY PRIMARY SCHOOL      738907 POINT (24322.52 47189.88)
2    AHMAD IBRAHIM PRIMARY SCHOOL      768643  POINT (27932.21 46161.2)
3                  AI TONG SCHOOL      579646 POINT (27956.94 38079.99)
4        ALEXANDRA PRIMARY SCHOOL      159016  POINT (26976.8 30415.01)
5     ANCHOR GREEN PRIMARY SCHOOL      544969 POINT (33988.81 41411.98)
6         ANDERSON PRIMARY SCHOOL      569785 POINT (28899.62 40719.89)
7       ANG MO KIO PRIMARY SCHOOL      569920 POINT (28665.38 39021.17)
8   ANGLO-CHINESE SCHOOL (JUNIOR)      227988 POINT (28903.58 32351.07)
9  ANGLO-CHINESE SCHOOL (PRIMARY)      309918  POINT (28265.23 33448.3)
10         ANGSANA PRIMARY SCHOOL      528565 POINT (39752.22 38402.06)</code></pre>
</div>
</div>
</section>
<section id="good-primary-schools" class="level4" data-number="3.3.2.2">
<h4 data-number="3.3.2.2" class="anchored" data-anchor-id="good-primary-schools"><span class="header-section-number">3.3.2.2</span> Good Primary Schools</h4>
<p>In Singapore’s Primary 1 (P1) registration, proximity to a school significantly influences admission priority. When a school has more applicants than available spots, priority is based on both the child’s citizenship and their distance from the school. This makes properties around well-regarded schools especially appealing to families, as living nearby can increase their child’s chances of admission. By including the top 20 primary schools from <a href="https://schlah.com/primary-schools">Schlah’s ranking</a>, we would like to find out how access to quality education factors into housing demand.</p>
<p>Since we already have the full list of primary schools with geocoding, we can now filter out the top 20 schools based on the Schlah ranking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>top_20_primary_schools <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NANYANG PRIMARY SCHOOL"</span>, <span class="st">"TAO NAN SCHOOL"</span>, <span class="st">"CATHOLIC HIGH SCHOOL"</span>, <span class="st">"NAN HUA PRIMARY SCHOOL"</span>, <span class="st">"ST. HILDA'S PRIMARY SCHOOL"</span>, <span class="st">"HENRY PARK PRIMARY SCHOOL"</span>, <span class="st">"ANGLO-CHINESE SCHOOL (PRIMARY)"</span>, <span class="st">"RAFFLES GIRLS' PRIMARY SCHOOL"</span>, <span class="st">"PEI HWA PRESBYTERIAN PRIMARY SCHOOL"</span>, <span class="st">"CHIJ ST. NICHOLAS GIRLS' SCHOOL"</span>, <span class="st">"ROSYTH SCHOOL"</span>, <span class="st">"KONG HWA SCHOOL"</span>, <span class="st">"POI CHING SCHOOL"</span>, <span class="st">"HOLY INNOCENTS' PRIMARY SCHOOL"</span>, <span class="st">"AI TONG SCHOOL"</span>, <span class="st">"RED SWASTIKA SCHOOL"</span>, <span class="st">"MARIS STELLA HIGH SCHOOL"</span>, <span class="st">"RULANG PRIMARY SCHOOL"</span>, <span class="st">"PEI CHUN PUBLIC SCHOOL"</span>, <span class="st">"SINGAPORE CHINESE GIRLS' PRIMARY SCHOOL"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>top_20_primary_schools_sf <span class="ot">&lt;-</span> primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SCHOOLNAME <span class="sc">%in%</span> top_20_primary_schools)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(top_20_primary_schools_sf, <span class="st">"data/rds/top_20_primary_schools_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>top_20_primary_schools_sf <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/top_20_primary_schools_sf.rds"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>top_20_primary_schools_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 20 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 15245.53 ymin: 31935.11 xmax: 39546.41 ymax: 39607.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
                        SCHOOLNAME POSTAL_CODE                  geometry
1                   AI TONG SCHOOL      579646 POINT (27956.94 38079.99)
2   ANGLO-CHINESE SCHOOL (PRIMARY)      309918  POINT (28265.23 33448.3)
3             CATHOLIC HIGH SCHOOL      579767 POINT (29162.18 37438.65)
4  CHIJ ST. NICHOLAS GIRLS' SCHOOL      569405 POINT (28101.77 39607.17)
5        HENRY PARK PRIMARY SCHOOL      278790  POINT (22524.4 33238.19)
6   HOLY INNOCENTS' PRIMARY SCHOOL      536451  POINT (34739.9 38763.19)
7                  KONG HWA SCHOOL      399772  POINT (34072.8 32603.63)
8         MARIS STELLA HIGH SCHOOL      368051 POINT (33052.36 36084.74)
9           NAN HUA PRIMARY SCHOOL      128806 POINT (20011.61 33542.72)
10          NANYANG PRIMARY SCHOOL      268097 POINT (25223.75 33700.87)</code></pre>
</div>
</div>
</section>
<section id="shopping-mall-in-singapore" class="level4" data-number="3.3.2.3">
<h4 data-number="3.3.2.3" class="anchored" data-anchor-id="shopping-mall-in-singapore"><span class="header-section-number">3.3.2.3</span> Shopping Mall in Singapore</h4>
<p>The <a href="https://github.com/ValaryLim/Mall-Coordinates-Web-Scraper">Mall Coordinates Web Scraper repository</a> provides a list of shopping malls in Singapore as of 2019. However, there have been some changes since then, so I manually updated the CSV file in the repository. I cross-referenced the information with <a href="https://en.wikipedia.org/wiki/List_of_shopping_malls_in_Singapore">Wikipedia’s list of shopping malls in Singapore</a>, added geocoding information for new malls using the Open Map API, and removed malls that have since closed.</p>
<p>Let’s read the CSV file using <code>read_csv()</code>, convert it to an <code>sf</code> object, and transform the CRS to 3414. Finally, we’ll save it in RDS format for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>malls <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/mall_coordinates_updated.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(malls, <span class="st">"data/rds/malls.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>malls <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/malls.rds"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>malls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 199 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 10760.28 ymin: 27369.76 xmax: 45400.14 ymax: 47763.06
Projected CRS: SVY21 / Singapore TM
# A tibble: 199 × 3
    ...1 name                               geometry
 * &lt;dbl&gt; &lt;chr&gt;                           &lt;POINT [m]&gt;
 1     0 100 AM                  (29129.86 28563.01)
 2     1 313@SOMERSET            (28485.88 31526.07)
 3     2 321 CLEMENTI            (20392.39 32702.67)
 4     3 600 @ TOA PAYOH          (29962.8 35137.08)
 5     4 888 PLAZA               (23767.99 46536.14)
 6     5 ADMIRALTY PLACE         (24491.47 46840.26)
 7     6 ALEXANDRA CENTRAL       (24879.92 29966.77)
 8     7 ALEXANDRA RETAIL CENTRE (24444.93 28480.59)
 9     8 AMK HUB                 (29685.94 39027.27)
10     9 ANCHORPOINT              (24916.03 30149.4)
# ℹ 189 more rows</code></pre>
</div>
</div>
</section>
<section id="hospitals" class="level4" data-number="3.3.2.4">
<h4 data-number="3.3.2.4" class="anchored" data-anchor-id="hospitals"><span class="header-section-number">3.3.2.4</span> Hospitals</h4>
<p>We’ll load the list of hospitals from <a href="https://en.wikipedia.org/wiki/List_of_hospitals_in_Singapore">Wikipedia’s List of Hospitals in Singapore</a>. Since general and specialty hospitals are more frequently accessed by the broader population, I’ve excluded the “Psychiatric hospital” category from this list. I’ve prepared a CSV file with each hospital’s name and postal code, which we’ll pass to the <code>get_coords</code> function to retrieve geolocation coordinates. Afterward, we’ll convert the data to an <code>sf</code> data frame and save it in RDS format for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>hospitals <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/hospitals.csv"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>address_list <span class="ot">&lt;-</span> hospitals <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">address =</span> <span class="fu">paste</span>(Name, <span class="st">`</span><span class="at">Postal Code</span><span class="st">`</span>, <span class="at">sep =</span> <span class="st">", "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(address)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>hospital_sf <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(address_list) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">toupper</span>(<span class="fu">str_extract</span>(address, <span class="st">"^[^,]+"</span>))) <span class="sc">%&gt;%</span>  <span class="co"># Extract and uppercase the hospital name</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, postal, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords=</span><span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hospital_sf, <span class="st">"data/rds/hospital_sf.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>hospital_sf <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/hospital_sf.rds"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hospital_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 29
Columns: 3
$ name     &lt;chr&gt; "CHANGI GENERAL HOSPITAL", "KK WOMEN'S AND CHILDREN'S HOSPITA…
$ postal   &lt;chr&gt; "529889", "229899", "544886", "169608", "768828", "308433", "…
$ geometry &lt;POINT [m]&gt; POINT (40925.91 35887.54), POINT (29483.67 32528.26), P…</code></pre>
</div>
</div>
</section>
<section id="hdb-resale-data" class="level4" data-number="3.3.2.5">
<h4 data-number="3.3.2.5" class="anchored" data-anchor-id="hdb-resale-data"><span class="header-section-number">3.3.2.5</span> HDB Resale Data</h4>
<p>Now, let’s load the historical HDB resale transactions data from <a href="https://data.gov.sg/">data.gov.sg</a>. To meet our objectives, we’ll filter for transactions from 2023 and from July to September 2024. The 2023 transactions will serve as our training dataset, while those from July to September 2024 will form our test set. We will also use only <code>5 ROOM</code> flat type in our exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/HDB_resale.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_starts</span>(month, <span class="st">"2023"</span>) <span class="sc">|</span> month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2024-07"</span>, <span class="st">"2024-08"</span>, <span class="st">"2024-09"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">address =</span> <span class="fu">paste</span>(block,street_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 192794 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (8): month, town, flat_type, block, street_name, storey_range, flat_mode...
dbl (3): floor_area_sqm, lease_commence_date, resale_price

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Next, we’ll retrieve the coordinates for each HDB block in the filtered <code>hdb_resale</code> dataset, then join this data with the coordinates result. Finally, we’ll save the output in RDS format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>address_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(hdb_resale<span class="sc">$</span>address))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>hdb_coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(address_list)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hdb_coords, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"address"</span> <span class="ot">=</span> <span class="st">"address"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hdb_resale, <span class="st">"data/rds/hdb_resale.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/rds/hdb_resale.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="data-pre-processing" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Data Pre-processing</h1>
<p>In this section, we’ll perform several data pre-processing steps: remove any z-dimensions in geospatial data, drop unnecessary columns, and check for invalid geometries.</p>
<section id="z-dimensions-removal" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="z-dimensions-removal"><span class="header-section-number">4.1</span> Z-Dimensions Removal</h2>
<p>We’ll use the <code>st_zm()</code> function to remove the z-dimension from the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>chas <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(chas)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>childcare <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(childcare)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>hawker_center <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(hawker_center)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>kindergartens <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(kindergartens)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(parks)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>supermarkets <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(supermarkets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="drop-unnecessary-columns" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="drop-unnecessary-columns"><span class="header-section-number">4.2</span> Drop Unnecessary Columns</h2>
<p>For most of our locational factor data frames, we only need the facility name (e.g., childcare center, eldercare) and its geometry column. Therefore, we can keep just the first column, which contains the name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> bus_stops <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>chas <span class="ot">&lt;-</span> chas <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>childcare <span class="ot">&lt;-</span> childcare <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> eldercare <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>hawker_center <span class="ot">&lt;-</span> hawker_center <span class="sc">%&gt;%</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>hospital_sf <span class="ot">&lt;-</span> hospital_sf <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>kindergartens <span class="ot">&lt;-</span> kindergartens <span class="sc">%&gt;%</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>malls <span class="ot">&lt;-</span> malls <span class="sc">%&gt;%</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">2</span>))</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> parks <span class="sc">%&gt;%</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>supermarkets <span class="ot">&lt;-</span> supermarkets <span class="sc">%&gt;%</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>primary_schools_sf <span class="ot">&lt;-</span> primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>top_20_primary_schools_sf <span class="ot">&lt;-</span> top_20_primary_schools_sf <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> train_stations <span class="sc">%&gt;%</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-invalid-geometries" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="check-invalid-geometries"><span class="header-section-number">4.3</span> Check Invalid Geometries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(bus_stops) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(chas) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(childcare) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(eldercare) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(hawker_center) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(hospital_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(kindergartens) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(malls) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(parks) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(supermarkets) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(primary_schools_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(top_20_primary_schools_sf) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(train_stations) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(hdb_resale) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>We noticed that <code>mpsz</code> and <code>train_stations</code> has invalid geometries. Let’s fix it using <a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid()</a> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(mpsz)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(mpsz) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Unfortunately, we can’t run <code>st_make_valid()</code> on the <code>train_stations</code> data frame as we did with the <code>mpsz</code> data frame. So, let’s check which stations have invalid geometries and the reason.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>stations_with_invalid_geometry <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STN_NAM_DE =</span> train_stations<span class="sc">$</span>STN_NAM_DE,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">validity_reason =</span> <span class="fu">st_is_valid</span>(train_stations, <span class="at">reason =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(validity_reason <span class="sc">!=</span> <span class="st">"Valid Geometry"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>stations_with_invalid_geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 STN_NAM_DE
1  HARBOURFRONT MRT STATION
2 UPPER THOMSON MRT STATION
                                       validity_reason
1 Self-intersection[26569.2890072806 27535.5768024939]
2 Self-intersection[27873.6944146205 37448.0837479433]</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>We identified two stations with invalid geometries: HarbourFront and Upper Thomson MRT stations. These geometries are invalid due to self-intersection errors. Since <code>st_make_valid()</code> doesn’t resolve this issue and no other resources were found to fix it, we’ll use the <code>get_coords()</code> function to retrieve their coordinates and add them to <code>train_stations</code>.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>invalid_station_names <span class="ot">&lt;-</span> train_stations<span class="sc">$</span>STN_NAM_DE[<span class="sc">!</span><span class="fu">st_is_valid</span>(train_stations<span class="sc">$</span>geometry)]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> train_stations <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">st_is_valid</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geometry =</span> <span class="fu">st_centroid</span>(geometry))</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>mrt_stations_sf <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(invalid_station_names) <span class="sc">%&gt;%</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">STN_NAM_DE =</span> address) <span class="sc">%&gt;%</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STN_NAM_DE, geometry)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(train_stations, mrt_stations_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s verify the <code>train_stations</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">st_is_valid</span>(train_stations) <span class="sc">==</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Everything looks good now; all geometry issues in our data have been resolved.</p>
</section>
</section>
<section id="data-visualization" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Data Visualization</h1>
<p>With all locational data loaded, transformed, and verified, let’s visualize it before proceeding with our analysis.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">mpsz</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">CHAS Clinics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Childcare center</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Eldercare center</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Hawker center</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">Hospital</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">Kindergartens</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-8" role="tab" aria-controls="tabset-2-8" aria-selected="false">Malls</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-9" role="tab" aria-controls="tabset-2-9" aria-selected="false">Mrt Stations &amp; Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-10" role="tab" aria-controls="tabset-2-10" aria-selected="false">Parks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-11-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-11" role="tab" aria-controls="tabset-2-11" aria-selected="false">Primary School &amp; Good Primary School</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-12-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-12" role="tab" aria-controls="tabset-2-12" aria-selected="false">Supermarkets</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(chas) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(childcare) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(eldercare) <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hawker_center) <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hospital_sf) <span class="sc">+</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(kindergartens) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(malls) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>stations_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(train_stations) <span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Train Stations"</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>bus_stops_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(bus_stops) <span class="sc">+</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Bus Stops"</span>,</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(stations_map, bus_stops_map, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(parks) <span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-11" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-11-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>schools_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(primary_schools_sf) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Primary Schools"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>goodschools_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(top_20_primary_schools_sf) <span class="sc">+</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Good Primary Schools"</span>,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(schools_map, goodschools_map, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-12" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-12-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(supermarkets) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>All locational data looks good based on the visualizations above, so let’s move on to working with our HDB resale data.</p>
</blockquote>
</section>
<section id="data-wrangling" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Data Wrangling</h1>
<p>In the previous section, we filtered the data to include only the desired period and retrieved geolocation information based on addresses using the <code>get_coords</code> function. Now, we’ll process both structural and locational factors in this data before creating our model.</p>
<section id="structural-factors" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="structural-factors"><span class="header-section-number">6.1</span> Structural Factors</h2>
<section id="floor-level" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="floor-level"><span class="header-section-number">6.1.1</span> Floor Level</h3>
<p>Let’s take a look at the <code>storey_range</code> column in our <code>hdb_resale</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(hdb_resale<span class="sc">$</span>storey_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "16 TO 18" "04 TO 06" "10 TO 12" "13 TO 15" "19 TO 21" "07 TO 09"
 [7] "34 TO 36" "22 TO 24" "01 TO 03" "25 TO 27" "37 TO 39" "31 TO 33"
[13] "40 TO 42" "28 TO 30" "43 TO 45"</code></pre>
</div>
</div>
<p>Typically, higher-floor units command higher prices. However, our data represents floor levels in the “storey_range” column as strings, such as “01 TO 03,” “04 TO 06,” and “07 TO 09.” To make this more usable, we’ll create a new numeric attribute that captures the midpoint of each range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">floor_level =</span> (<span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(storey_range, <span class="st">"^[0-9]+"</span>)) <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(storey_range, <span class="st">"[0-9]+$"</span>))) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remaining-lease-units-age" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="remaining-lease-units-age"><span class="header-section-number">6.1.2</span> Remaining Lease &amp; Unit’s Age</h3>
<p>The <code>remaining_lease</code> column is currently in string format, but we need it as a numeric value so we can use it in our model later. From this, we’ll also calculate the unit’s age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_years =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>)),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_months =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>)),</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace NA in months with 0 if "months" part is missing</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_months =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(remaining_lease_months), <span class="dv">0</span>, remaining_lease_months),</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate remaining lease in decimal years</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease =</span> remaining_lease_years <span class="sc">+</span> (remaining_lease_months <span class="sc">/</span> <span class="dv">12</span>),</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate unit age based on a 99-year lease</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit_age =</span> <span class="dv">99</span> <span class="sc">-</span> remaining_lease</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>remaining_lease_years, <span class="sc">-</span>remaining_lease_months)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="locational-factors" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="locational-factors"><span class="header-section-number">6.2</span> Locational Factors</h2>
<section id="proximity-calculation" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="proximity-calculation"><span class="header-section-number">6.2.1</span> Proximity Calculation</h3>
<p>We need to calculate the proximity of HDB flats to relevant facilities. We’re grateful to have functions provided by Megan, which help streamline this process.</p>
<p>The <code>proximity</code> function calculates the minimum distance from each feature in <code>df1</code> to the nearest feature in <code>df2</code> and assigns this distance to a new column specified by <code>varname</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>proximity <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname) {</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>()</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowMins</span>(dist_matrix)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>One of the proximities we need to calculate is the distance to the CBD. For this, we’ll use Raffles Place MRT station as the central reference point from the train stations data.</p>
</div>
</div>
</div>
<p>Let’s calculate the proximity of following facilities:</p>
<ul>
<li>Proxomity to CBD</li>
<li>Proximity to eldercare</li>
<li>Proximity to hawker centres</li>
<li>Proximity to MRT</li>
<li>Proximity to park</li>
<li>Proximity to good primary school</li>
<li>Proximity to shopping mall</li>
<li>Proximity to supermarket</li>
<li>Proximity to hospital</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>cbd_sf <span class="ot">&lt;-</span> <span class="fu">filter</span>(train_stations, STN_NAM_DE <span class="sc">==</span> <span class="st">"RAFFLES PLACE MRT STATION"</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> <span class="fu">proximity</span>(hdb_resale, cbd_sf, <span class="st">"PROX_CBD"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., eldercare, <span class="st">"PROX_ELDERCARE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., hawker_center, <span class="st">"PROX_HAWKER"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., train_stations, <span class="st">"PROX_MRT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., parks, <span class="st">"PROX_PARK"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., top_20_primary_schools_sf, <span class="st">"PROX_TOPPRISCH"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., malls, <span class="st">"PROX_MALL"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., supermarkets, <span class="st">"PROX_SPRMKT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">proximity</span>(., hospital_sf, <span class="st">"PROX_HOSPITAL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="facility-count-within-radius-calculation" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="facility-count-within-radius-calculation"><span class="header-section-number">6.2.2</span> Facility Count within Radius Calculation</h3>
<p>We also need to calculate the number of facilities within a certain radius from the resale flats. Thankfully, Megan has wrote a function that we can reuse in this exercise. The <code>count_in_radius</code> function calculates the number of features in <code>df2</code> that are within a specified <code>radius</code> of each feature in <code>df1</code> using <code>st_distance</code>. It computes the distance matrix between <code>df1</code> and <code>df2</code>, checks if each distance is within the <code>radius</code>, and sums these counts in a new column in <code>df1</code> (specified by <code>varname</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>count_in_radius <span class="ot">&lt;-</span> <span class="cf">function</span>(df1, df2, varname, radius) {</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  dist_matrix <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(df1, df2) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_units</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  df1[,varname] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(dist_matrix <span class="sc">&lt;=</span> radius)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df1)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s calculate the following:</p>
<ul>
<li>Numbers of kindergartens within 350m</li>
<li>Numbers of childcare centres within 350m</li>
<li>Numbers of bus stop within 350m</li>
<li>Numbers of CHAS clinics within 350m</li>
<li>Numbers of primary school within 1km</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> <span class="fu">count_in_radius</span>(hdb_resale, kindergartens, <span class="st">"NUM_KNDRGTN"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_in_radius</span>(., childcare, <span class="st">"NUM_CHILDCARE"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_in_radius</span>(., bus_stops, <span class="st">"NUM_BUS_STOP"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_in_radius</span>(., chas, <span class="st">"NUM_CHAS"</span>, <span class="dv">350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count_in_radius</span>(., primary_schools_sf, <span class="st">"NUM_PRISCH"</span>, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will filter out unnecessary columns and save the results to avoid recalculating them during rendering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>hdb_resale <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MONTH =</span> month,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">TOWN =</span> town,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">FLOOR_AREA_SQM =</span> floor_area_sqm,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ADDRESS =</span> address,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RESALE_PRICE =</span> resale_price,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FLOOR_LEVEL =</span> floor_level,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">REMAINING_LEASE =</span> remaining_lease,</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">UNIT_AGE =</span> unit_age</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(MONTH, TOWN, FLOOR_AREA_SQM, ADDRESS, RESALE_PRICE, FLOOR_LEVEL, REMAINING_LEASE,</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>         UNIT_AGE, PROX_CBD, PROX_ELDERCARE, PROX_HAWKER, PROX_MRT, PROX_PARK,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>         PROX_TOPPRISCH, PROX_MALL, PROX_SPRMKT, PROX_HOSPITAL, NUM_KNDRGTN,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>         NUM_CHILDCARE, NUM_BUS_STOP, NUM_CHAS, NUM_PRISCH)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hdb_resale, <span class="st">"data/rds/final_hdb_resale.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Exploratory Data Analysis</h1>
<p>Let’s explore and analyze the dataset before starting to build our model.</p>
<section id="resale-price" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="resale-price"><span class="header-section-number">7.1</span> Resale Price</h2>
<p>We’ll start by visualizing the distribution of resale prices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hdb_resale, <span class="fu">aes</span>(<span class="at">x=</span>RESALE_PRICE)) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the graph above, we can see that for 5-room HDB flats:</p>
<ul>
<li>The distribution of resale prices is right-skewed.</li>
<li>Most resale HDBs are transacted around the $500,000–$600,000 range.</li>
<li>Outliers are present, with some HDB prices reaching close to $1 million or more.</li>
</ul>
<blockquote class="blockquote">
<p>Statistically, the skewed distribution can be normalized by using a log transformation. However, we’ll not apply it here because we want to retain the original scale of resale prices for easier interpretation and comparison.</p>
</blockquote>
<p>We can also visualize the geospatial distribution of resale prices for 5-room housing units in Singapore.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale) <span class="sc">+</span>  </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"RESALE_PRICE"</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The map shows that HDB flats generally have higher prices near the downtown area. Additionally, prices in the North-East and East regions are noticeably higher than in the North and West, where resale prices tend to be more affordable.</p>
</blockquote>
</section>
<section id="locational-factors-1" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="locational-factors-1"><span class="header-section-number">7.2</span> Locational Factors</h2>
<p>We’ll examine the distribution of our locational factors using <code>ggplot</code> for each factor and arrange them with <code>ggarrange</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>PROX_CBD <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_CBD)) <span class="sc">+</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>PROX_ELDERCARE <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_ELDERCARE)) <span class="sc">+</span> </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>PROX_HAWKER <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_HAWKER)) <span class="sc">+</span> </span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>PROX_MRT <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_MRT)) <span class="sc">+</span> </span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>PROX_PARK <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_PARK)) <span class="sc">+</span> </span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>PROX_TOPPRISCH <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_TOPPRISCH)) <span class="sc">+</span> </span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>PROX_MALL <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_MALL)) <span class="sc">+</span> </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>PROX_SPRMKT <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_SPRMKT)) <span class="sc">+</span> </span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>PROX_HOSPITAL <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> PROX_HOSPITAL)) <span class="sc">+</span> </span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a>NUM_KNDRGTN <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> NUM_KNDRGTN)) <span class="sc">+</span> </span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>NUM_BUS_STOP <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> NUM_BUS_STOP)) <span class="sc">+</span> </span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>NUM_CHILDCARE <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> NUM_CHILDCARE)) <span class="sc">+</span> </span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>NUM_CHAS <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> NUM_CHAS)) <span class="sc">+</span> </span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>NUM_PRISCH <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale, <span class="fu">aes</span>(<span class="at">x =</span> NUM_PRISCH)) <span class="sc">+</span> </span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(PROX_CBD, PROX_ELDERCARE, PROX_HAWKER, PROX_MRT, PROX_PARK, PROX_TOPPRISCH, PROX_MALL, PROX_SPRMKT, PROX_HOSPITAL, NUM_KNDRGTN, NUM_BUS_STOP, NUM_CHILDCARE, NUM_CHAS, NUM_PRISCH, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The distribution of <code>PROX_CBD</code> is left-skewed, indicating that most HDB flats are relatively far from the Central Business District, with only a few located nearby. In contrast, <code>NUM_BUS_STOP</code> shows a more normal distribution, suggesting that bus stops are relatively evenly distributed around HDB flats, with many flats having access to several nearby. The remaining proximity and count variables are generally right-skewed, indicating that while some flats have access to numerous facilities within a certain radius, the majority have fewer nearby amenities, with access decreasing further from these central locations.</p>
</div>
</div>
</section>
<section id="structural-factors-1" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="structural-factors-1"><span class="header-section-number">7.3</span> Structural Factors</h2>
<p>Next, we’ll explore the distribution of our structural factors by visualizing each one with <code>ggplot</code> and organizing them using <code>ggarrange</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>UNIT_AREA <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>hdb_resale, <span class="fu">aes</span>(<span class="at">x=</span> FLOOR_AREA_SQM)) <span class="sc">+</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>UNIT_FLOOR_LEVEL <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>hdb_resale, <span class="fu">aes</span>(<span class="at">x=</span> FLOOR_LEVEL)) <span class="sc">+</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>UNIT_REMAINING_LEASE <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>hdb_resale, <span class="fu">aes</span>(<span class="at">x=</span> REMAINING_LEASE)) <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>UNIT_AGE <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>hdb_resale, <span class="fu">aes</span>(<span class="at">x=</span> UNIT_AGE)) <span class="sc">+</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">20</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>)</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(UNIT_AREA, UNIT_FLOOR_LEVEL, UNIT_REMAINING_LEASE, UNIT_AGE, </span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Both floor area (in square meters) and floor level are right-skewed, indicating that most HDB flats sold are smaller in size and located on lower floors, with fewer transactions historically for larger units or those on higher floors. In contrast, the remaining lease is slightly left-skewed, with most flats retaining a lease duration near the upper limit of 99 years, and only a small number having shorter remaining leases. The distribution of unit age shows a bimodal pattern, with peaks around both newer and older flats, suggesting that sales include a mix of recently built and much older properties.</p>
</div>
</div>
</section>
<section id="multicollinearity-analysis" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="multicollinearity-analysis"><span class="header-section-number">7.4</span> Multicollinearity Analysis</h2>
<p>In this section, we’ll analyze the dataset for multicollinearity, where predictor variables are highly correlated. Identifying multicollinearity helps improve model stability and interpretability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>hdb_resale_nogeo <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrmat</span>(hdb_resale_nogeo, <span class="fu">names</span>(hdb_resale_nogeo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The correlation matrix shows a strong negative correlation between <code>UNIT_AGE</code> and <code>REMAINING_LEASE</code>, as expected, since <code>UNIT_AGE</code> is derived from <code>REMAINING_LEASE</code>; one of these can be removed to avoid multicollinearity. Resale price has moderate positive correlations with <code>FLOOR_AREA_SQM</code> (0.63) and <code>FLOOR_LEVEL</code> (0.45), suggesting that larger and higher-floor units tend to be more expensive. Most other variables show low or no significant correlations.</p>
</div>
</div>
</section>
</section>
<section id="multiple-linear-regression" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Multiple Linear Regression</h1>
<section id="prepare-train-and-test-data" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="prepare-train-and-test-data"><span class="header-section-number">8.1</span> Prepare Train and Test Data</h2>
<p>Before creating our model, we’ll split the HDB resale dataset into training and test sets. Resale transactions from 2023 will be used for training, while the remaining data will be used for testing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>hdb_resale_train <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_sub</span>(MONTH, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">==</span> <span class="st">"2023"</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>hdb_resale_test <span class="ot">&lt;-</span> hdb_resale <span class="sc">%&gt;%</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_sub</span>(MONTH, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">!=</span> <span class="st">"2023"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calibrate-multiple-linear-regression-model" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="calibrate-multiple-linear-regression-model"><span class="header-section-number">8.2</span> Calibrate Multiple Linear Regression Model</h2>
<p>We’ll use the <code>lm()</code> function to fit a multiple linear regression model, incorporating the selected independent variables to predict the dependent variable. We’ll also apply <code>ols_regress</code> on the model for</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>resale_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> RESALE_PRICE <span class="sc">~</span> FLOOR_AREA_SQM <span class="sc">+</span> FLOOR_LEVEL <span class="sc">+</span> REMAINING_LEASE <span class="sc">+</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                     PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span> PROX_PARK <span class="sc">+</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                     PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_SPRMKT <span class="sc">+</span> PROX_HOSPITAL <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                     NUM_CHILDCARE <span class="sc">+</span> NUM_BUS_STOP <span class="sc">+</span> NUM_CHAS <span class="sc">+</span> NUM_PRISCH, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>hdb_resale_train)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(resale_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.853       RMSE                    73652.485 
R-Squared                   0.728       MSE                5441451470.022 
Adj. R-Squared              0.728       Coef. Var                  10.764 
Pred R-Squared              0.727       AIC                    147586.040 
MAE                     54578.193       SBC                    147712.827 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                    ANOVA                                      
------------------------------------------------------------------------------
                    Sum of                                                    
                   Squares          DF       Mean Square       F         Sig. 
------------------------------------------------------------------------------
Regression    8.501878e+13          17      5.001105e+12    919.076    0.0000 
Residual      3.169645e+13        5825    5441451470.022                      
Total         1.167152e+14        5842                                        
------------------------------------------------------------------------------

                                            Parameter Estimates                                              
------------------------------------------------------------------------------------------------------------
          model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
------------------------------------------------------------------------------------------------------------
    (Intercept)    -287580.326     28115.034                 -10.229    0.000    -342696.231    -232464.420 
 FLOOR_AREA_SQM       6561.317       181.342        0.332     36.182    0.000       6205.818       6916.816 
    FLOOR_LEVEL       6563.971       172.847        0.277     37.976    0.000       6225.126       6902.815 
REMAINING_LEASE       6510.972       110.271        0.559     59.045    0.000       6294.801       6727.144 
       PROX_CBD        -21.324         0.402       -0.598    -53.061    0.000        -22.112        -20.536 
 PROX_ELDERCARE         -5.460         1.799       -0.025     -3.034    0.002         -8.987         -1.932 
    PROX_HAWKER        -29.545         1.991       -0.115    -14.842    0.000        -33.447        -25.642 
       PROX_MRT        -41.105         3.057       -0.108    -13.447    0.000        -47.098        -35.113 
      PROX_PARK         -1.948         2.453       -0.006     -0.794    0.427         -6.757          2.861 
 PROX_TOPPRISCH          1.631         0.530        0.029      3.078    0.002          0.592          2.670 
      PROX_MALL        -12.577         3.328       -0.030     -3.779    0.000        -19.100         -6.053 
    PROX_SPRMKT          9.954         6.882        0.011      1.446    0.148         -3.537         23.445 
  PROX_HOSPITAL          2.133         0.914        0.020      2.334    0.020          0.342          3.924 
    NUM_KNDRGTN       8111.601      1063.282        0.062      7.629    0.000       6027.173      10196.029 
  NUM_CHILDCARE      -4036.410       514.169       -0.068     -7.850    0.000      -5044.372      -3028.448 
   NUM_BUS_STOP        371.925       344.524        0.008      1.080    0.280       -303.471       1047.320 
       NUM_CHAS       7425.302       537.428        0.109     13.816    0.000       6371.744       8478.860 
     NUM_PRISCH      -9707.602       743.959       -0.113    -13.049    0.000     -11166.038      -8249.166 
------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the parameter estimates, several factors stand out as significant predictors. <code>FLOOR_AREA_SQM</code> and <code>REMAINING_LEASE</code> have large positive coefficients, indicating that larger floor areas and longer leases are strong drivers of higher resale prices. <code>FLOOR_LEVEL</code> also contributes positively, suggesting that units on higher floors tend to be more valuable.</p>
<p>A few variables exhibit high p-values, suggesting they do not significantly impact resale prices in this model. These include <code>NUM_BUS_STOP</code>, <code>PROX_SPRMKT</code>, and <code>PROX_PARK</code>. We will remove these predictors and recalibrating the model to see if it improves the model’s performance and interpretability.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>resale_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> RESALE_PRICE <span class="sc">~</span> FLOOR_AREA_SQM <span class="sc">+</span> FLOOR_LEVEL <span class="sc">+</span> REMAINING_LEASE <span class="sc">+</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>                     PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>                     PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_HOSPITAL <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>                     NUM_CHILDCARE <span class="sc">+</span> NUM_CHAS <span class="sc">+</span> NUM_PRISCH, </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>hdb_resale_train)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_regress</span>(resale_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.853       RMSE                    73677.133 
R-Squared                   0.728       MSE                5442291241.733 
Adj. R-Squared              0.728       Coef. Var                  10.765 
Pred R-Squared              0.727       AIC                    147583.950 
MAE                     54561.661       SBC                    147690.718 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                      
-------------------------------------------------------------------------------
                    Sum of                                                     
                   Squares          DF       Mean Square       F          Sig. 
-------------------------------------------------------------------------------
Regression    8.499756e+13          14      6.071255e+12     1115.57    0.0000 
Residual      3.171767e+13        5828    5442291241.733                       
Total         1.167152e+14        5842                                         
-------------------------------------------------------------------------------

                                            Parameter Estimates                                              
------------------------------------------------------------------------------------------------------------
          model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper 
------------------------------------------------------------------------------------------------------------
    (Intercept)    -276953.384     27592.764                 -10.037    0.000    -331045.440    -222861.327 
 FLOOR_AREA_SQM       6529.004       180.357        0.330     36.200    0.000       6175.437       6882.572 
    FLOOR_LEVEL       6571.950       172.695        0.277     38.055    0.000       6233.404       6910.497 
REMAINING_LEASE       6480.299       109.106        0.557     59.394    0.000       6266.410       6694.188 
       PROX_CBD        -21.298         0.389       -0.597    -54.765    0.000        -22.060        -20.536 
 PROX_ELDERCARE         -5.506         1.748       -0.025     -3.149    0.002         -8.933         -2.078 
    PROX_HAWKER        -29.775         1.969       -0.116    -15.120    0.000        -33.635        -25.914 
       PROX_MRT        -41.084         3.040       -0.108    -13.514    0.000        -47.043        -35.124 
 PROX_TOPPRISCH          1.486         0.516        0.026      2.882    0.004          0.475          2.498 
      PROX_MALL        -12.328         3.225       -0.030     -3.823    0.000        -18.649         -6.007 
  PROX_HOSPITAL          2.406         0.897        0.023      2.681    0.007          0.647          4.165 
    NUM_KNDRGTN       8123.408      1061.878        0.062      7.650    0.000       6041.732      10205.083 
  NUM_CHILDCARE      -3988.427       507.203       -0.068     -7.864    0.000      -4982.733      -2994.121 
       NUM_CHAS       7244.875       508.355        0.106     14.252    0.000       6248.311       8241.440 
     NUM_PRISCH      -9754.911       740.932       -0.114    -13.166    0.000     -11207.412      -8302.411 
------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>After removing <code>NUM_BUS_STOP</code>, <code>PROX_SPRMKT</code>, and <code>PROX_PARK</code>, all remaining variables are now statistically significant.</p>
</blockquote>
</section>
<section id="multicollinearity-check" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="multicollinearity-check"><span class="header-section-number">8.3</span> Multicollinearity Check</h2>
<p>Next, we’ll run <code>ols_vif_tol</code> on the model to check for multicollinearity. Identifying multicollinearity is important because multicollinearity can inflate the variance of coefficient estimates, making the model less reliable and harder to interpret.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_vif_tol</span>(resale_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Variables Tolerance      VIF
1   FLOOR_AREA_SQM 0.5607675 1.783270
2      FLOOR_LEVEL 0.8778497 1.139147
3  REMAINING_LEASE 0.5308417 1.883801
4         PROX_CBD 0.3924173 2.548307
5   PROX_ELDERCARE 0.7217715 1.385480
6      PROX_HAWKER 0.7928210 1.261319
7         PROX_MRT 0.7310426 1.367909
8   PROX_TOPPRISCH 0.5572408 1.794556
9        PROX_MALL 0.7809256 1.280532
10   PROX_HOSPITAL 0.6347824 1.575343
11     NUM_KNDRGTN 0.7117069 1.405073
12   NUM_CHILDCARE 0.6304616 1.586140
13        NUM_CHAS 0.8392599 1.191526
14      NUM_PRISCH 0.6272019 1.594383</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The VIF values in the output are all below 5, which suggests that multicollinearity is not a significant issue in the model. Each predictor variable has a relatively low VIF, indicating minimal correlation with the other predictors. This means the model’s coefficients are likely to be stable and reliable, with each variable contributing independently to the prediction of the resale price.</p>
</blockquote>
</section>
<section id="test-for-non-linearity" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="test-for-non-linearity"><span class="header-section-number">8.4</span> Test for Non-Linearity</h2>
<p>In multiple linear regression, it’s important to test the assumption of linearity and additivity in the relationship between the dependent and independent variables. We’ll use <code>ols_plot_resid_fit()</code> from the <code>olsrr</code> package to check the linearity assumption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_plot_resid_fit</span>(resale_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>We observed that the data points are scattered around the zero line, with some outliers. We can conclude that the relationships between the dependent variable and independent variables are approximately linear.</p>
</blockquote>
</section>
<section id="test-for-normality" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="test-for-normality"><span class="header-section-number">8.5</span> Test for Normality</h2>
<p>We can use <a href="https://olsrr.rsquaredacademy.com/reference/ols_plot_resid_hist.html"><code>ols_plot_resid_hist()</code></a> from the <em>olsrr</em> package to test the normality assumption. Testing for normality is important because, in linear regression, normally distributed residuals indicate that the model’s predictions are unbiased and the statistical inferences (like confidence intervals and p-values) are valid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_plot_resid_hist</span>(resale_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The residual histogram shows that the residuals are roughly centered around zero and follow an approximate bell shape. This supports the normality assumption, with minor deviations that are unlikely to impact the model’s validity.</p>
</blockquote>
</section>
<section id="test-for-spatial-autocorrelation" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="test-for-spatial-autocorrelation"><span class="header-section-number">8.6</span> Test for Spatial Autocorrelation</h2>
<p>Since the hedonic model uses geographically referenced attributes, it’s important to examine the spatial distribution of its residuals. We’ll take the residuals from the model and merge them with <code>hdb_resale_train</code> to visualize any potential spatial autocorrelation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>mlr_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(resale_mlr<span class="sc">$</span>residuals)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>resale_res <span class="ot">&lt;-</span> <span class="fu">cbind</span>(hdb_resale_train,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>                    mlr_res) <span class="sc">%&gt;%</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MLR_RES =</span> resale_mlr.residuals)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(resale_res) <span class="sc">+</span>  </span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"MLR_RES"</span>,</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Multiple Linear Regression Residuals"</span>,     </span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "MLR_RES" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The map shows spatial patterns in the model’s residuals, suggesting potential spatial autocorrelation.</p>
</blockquote>
<p>To statistically confirm our observation of spatial autocorrelation, we’ll perform Moran’s I Test. The steps are as follows:</p>
<ol type="1">
<li>Use <code>dnearneigh()</code> from the <strong>spdep</strong> package to create a distance-based weight matrix.</li>
<li>Convert the neighbor list (<code>nb</code>) into spatial weights.</li>
<li>Conduct Moran’s I Test to assess spatial autocorrelation.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>resale_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(resale_res)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(<span class="fu">coordinates</span>(resale_sp), <span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>nb_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">'W'</span>)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.morantest</span>(resale_mlr, nb_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Global Moran I for regression residuals

data:  
model: lm(formula = RESALE_PRICE ~ FLOOR_AREA_SQM + FLOOR_LEVEL +
REMAINING_LEASE + PROX_CBD + PROX_ELDERCARE + PROX_HAWKER + PROX_MRT +
PROX_TOPPRISCH + PROX_MALL + PROX_HOSPITAL + NUM_KNDRGTN +
NUM_CHILDCARE + NUM_CHAS + NUM_PRISCH, data = hdb_resale_train)
weights: nb_lw

Moran I statistic standard deviate = 224.14, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Observed Moran I      Expectation         Variance 
    3.030779e-01    -1.203103e-03     1.842874e-06 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The Global Moran’s I test for residual spatial autocorrelation shows a p-value less than the alpha value of 0.05, so we reject the null hypothesis that the residuals are randomly distributed. Since the observed Global Moran’s I is greater than 0, we can infer that the residuals exhibit a clustered distribution.</p>
</blockquote>
</section>
</section>
<section id="geographically-weighted-random-forest" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Geographically Weighted Random Forest</h1>
<section id="data-preparation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">9.1</span> Data Preparation</h2>
<p>Before calibrating the random forest model, we need coordinate data that is needed by the SpatialML package. We can obtain this using <code>st_coordinates()</code> from the <strong>sf</strong> package. Then, we’ll remove the geometry data from <code>hdb_resale_train</code> with <code>st_drop_geometry()</code> to create an aspatial dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(hdb_resale_train)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>hdb_resale_train_nogeo <span class="ot">&lt;-</span> hdb_resale_train <span class="sc">%&gt;%</span> </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-optimum-bandwidth" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="compute-optimum-bandwidth"><span class="header-section-number">9.2</span> Compute Optimum Bandwidth</h2>
<p>We need to determine the optimal bandwidth for our geographically weighted random forest model. We’ll use an adaptive bandwidth because it allows the bandwidth to vary depending on the density of data points, providing more flexibility in areas with sparse data. For this, we’ll use a cross-validation (CV) approach with the <code>bw.gwr()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(<span class="at">formula =</span> RESALE_PRICE <span class="sc">~</span> FLOOR_AREA_SQM <span class="sc">+</span> FLOOR_LEVEL <span class="sc">+</span> REMAINING_LEASE <span class="sc">+</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>                     PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>                     PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_HOSPITAL <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>                     NUM_CHILDCARE <span class="sc">+</span> NUM_CHAS <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data=</span>resale_sp, </span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">approach=</span><span class="st">"CV"</span>, </span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel=</span><span class="st">"gaussian"</span>, </span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">longlat=</span><span class="cn">FALSE</span>)</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw_adaptive, <span class="st">"data/model/bw_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/model/bw_adaptive.rds"</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>bw_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The optimal bandwidth for this dataset is 40.</p>
</blockquote>
</section>
<section id="calibrate-geographically-weighted-random-forest-model" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="calibrate-geographically-weighted-random-forest-model"><span class="header-section-number">9.3</span> Calibrate Geographically Weighted Random Forest Model</h2>
<p>Using the adaptive bandwidth calculated earlier, we can build a Geographically Weighted Random Forest model with <code>grf()</code> from the <strong>SpatialML</strong> package. We’ll specify the target variable, predictors, data frame (excluding coordinates), kernel type, and coordinates as a separate data frame. To save time during rendering, we’ll also save the model for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(<span class="at">formula =</span> RESALE_PRICE <span class="sc">~</span> FLOOR_AREA_SQM <span class="sc">+</span> FLOOR_LEVEL <span class="sc">+</span> REMAINING_LEASE <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>                     PROX_CBD <span class="sc">+</span> PROX_ELDERCARE <span class="sc">+</span> PROX_HAWKER <span class="sc">+</span> PROX_MRT <span class="sc">+</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>                     PROX_TOPPRISCH <span class="sc">+</span> PROX_MALL <span class="sc">+</span> PROX_HOSPITAL <span class="sc">+</span> NUM_KNDRGTN <span class="sc">+</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>                     NUM_CHILDCARE <span class="sc">+</span> NUM_CHAS <span class="sc">+</span> NUM_PRISCH,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>hdb_resale_train_nogeo, </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw =</span> bw_adaptive,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ntree =</span> <span class="dv">200</span>,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/model/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at the importance of parameters from the geographically weighted random forest model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>variable_importance <span class="ot">&lt;-</span> gwRF_adaptive<span class="sc">$</span>Global.Model<span class="sc">$</span>variable.importance</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(variable_importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       PROX_CBD REMAINING_LEASE     FLOOR_LEVEL  PROX_TOPPRISCH  FLOOR_AREA_SQM 
   3.593875e+13    2.243939e+13    1.218517e+13    8.940477e+12    6.668454e+12 
    PROX_HAWKER   PROX_HOSPITAL        PROX_MRT  PROX_ELDERCARE       PROX_MALL 
   5.518551e+12    4.812411e+12    4.355106e+12    3.646059e+12    3.523533e+12 
       NUM_CHAS      NUM_PRISCH   NUM_CHILDCARE     NUM_KNDRGTN 
   3.261348e+12    2.206698e+12    1.132586e+12    8.993930e+11 </code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>We can see the top five parameters by importance in the geographically weighted random forest model are:</p>
<ul>
<li><strong>PROX_CBD</strong>: Proximity to the Central Business District (CBD)</li>
<li><strong>REMAINING_LEASE</strong>: Remaining lease duration of the property</li>
<li><strong>FLOOR_LEVEL</strong>: Floor level of the unit</li>
<li><strong>PROX_TOPPRISCH</strong>: Proximity to top primary schools</li>
<li><strong>FLOOR_AREA_SQM</strong>: Floor area in square meters</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Model Evaluation</h1>
<p>In this section, we will evaluate the models we calibrated earlier (Multiple Linear Regression and Geographically Weighted Random Forest).</p>
<section id="prepare-test-data" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="prepare-test-data"><span class="header-section-number">10.1</span> Prepare Test Data</h2>
<p>First, let’s prepare the test data, which includes transactions from July to September 2024. Similar to the training data, we need coordinate data required by the SpatialML package. We can obtain this using <code>st_coordinates()</code> from the <strong>sf</strong> package. Then, we’ll remove the geometry data from <code>hdb_resale_test</code> using <code>st_drop_geometry()</code> to create an aspatial dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(hdb_resale_test)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>hdb_resale_test_nogeo <span class="ot">&lt;-</span> <span class="fu">cbind</span>(hdb_resale_test, coords_test) <span class="sc">%&gt;%</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-predictions-on-test-data" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="model-predictions-on-test-data"><span class="header-section-number">10.2</span> Model Predictions on Test Data</h2>
<section id="multiple-linear-regression-1" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="multiple-linear-regression-1"><span class="header-section-number">10.2.1</span> Multiple Linear Regression</h3>
<p>We’ll use the Multiple Linear Regression model to make predictions on the test data with <code>predict()</code> functions, then store the results in <code>PREDICT_MLR</code> within <code>hdb_resale_test</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>hdb_resale_test<span class="sc">$</span>PREDICT_MLR <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> resale_mlr, <span class="at">newdata =</span> hdb_resale_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geographically-weighted-random-forest-1" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="geographically-weighted-random-forest-1"><span class="header-section-number">10.2.2</span> Geographically Weighted Random Forest</h3>
<p>We’ll also use the Geographically Weighted Random Forest model to make predictions with <code>predict.grf()</code> function, then store the results in <code>PREDICT_GWRF</code> within <code>hdb_resale_test</code>. Finally, we’ll save <code>hdb_resale_test</code> as an RDS file to preserve the predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>hdb_resale_test<span class="sc">$</span>PREDICT_GWRF <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive,</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                                            hdb_resale_test_nogeo, </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">global.w=</span><span class="dv">0</span>)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(hdb_resale_test, <span class="st">"data/rds/hdb_resale_test_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="calculate-root-mean-square-error-rmse" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="calculate-root-mean-square-error-rmse"><span class="header-section-number">10.3</span> Calculate Root Mean Square Error (RMSE)</h2>
<p>We’ll use RMSE as the metric to compare the prediction performance of both models. The RMSE can be calculated with the <code>rmse()</code> function from the <strong>Metrics</strong> package. After calculating the RMSE for each model, we’ll store the results in a data frame and display them in a table format for easy comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>rmse_mlr <span class="ot">&lt;-</span> <span class="fu">rmse</span>(hdb_resale_test<span class="sc">$</span>RESALE_PRICE, hdb_resale_test<span class="sc">$</span>PREDICT_MLR)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>rmse_gwrf <span class="ot">&lt;-</span> <span class="fu">rmse</span>(hdb_resale_test<span class="sc">$</span>RESALE_PRICE, hdb_resale_test<span class="sc">$</span>PREDICT_GWRF)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>rmse_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Multiple Linear Regression"</span>, <span class="st">"Geographically Weighted Random Forest"</span>),</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">c</span>(rmse_mlr, rmse_gwrf)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(rmse_results, <span class="at">caption =</span> <span class="st">"RMSE Comparison of Model Predictions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>RMSE Comparison of Model Predictions</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Multiple Linear Regression</td>
<td style="text-align: right;">97605.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">Geographically Weighted Random Forest</td>
<td style="text-align: right;">72074.30</td>
</tr>
</tbody>
</table>
</div>
</div>
<blockquote class="blockquote">
<p>We observe that the Geographically Weighted Random Forest model has a lower RMSE than the Multiple Linear Regression model, indicating better predictive performance on the test data. This suggests that incorporating geographic variation improves accuracy in predicting HDB resale prices.</p>
</blockquote>
</section>
<section id="model-predictions-visualization" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="model-predictions-visualization"><span class="header-section-number">10.4</span> Model Predictions Visualization</h2>
<p>We can visualize the predictions of both models against actual sale prices using scatterplots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>plot_mlr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale_test,</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> PREDICT_MLR,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> RESALE_PRICE)) <span class="sc">+</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Resale Price vs Predicted Price (MLR)"</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>plot_gwrf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> hdb_resale_test,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> PREDICT_GWRF,</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> RESALE_PRICE)) <span class="sc">+</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Resale Price vs Predicted Price (GWRF)"</span>)</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(plot_mlr, plot_gwrf, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The Geographically Weighted Random Forest (GWRF) model shows predictions more tightly clustered along the diagonal line, indicating better accuracy. In contrast, the Multiple Linear Regression (MLR) model has a wider spread, especially at higher prices, aligning with the RMSE results that favor the GWRF model.</p>
</blockquote>
</section>
<section id="visualization-of-model-residuals" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="visualization-of-model-residuals"><span class="header-section-number">10.5</span> Visualization of Model Residuals</h2>
<p>We can visualize the residuals of the model predictions on the test set to compare the accuracy of the Multiple Linear Regression and Geographically Weighted Random Forest models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>hdb_resale_test <span class="ot">&lt;-</span> hdb_resale_test <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MLR_RES =</span> RESALE_PRICE <span class="sc">-</span> PREDICT_MLR,</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">GWRF_RES =</span> RESALE_PRICE <span class="sc">-</span> PREDICT_GWRF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>common_breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">400000</span>, <span class="dv">400000</span>, <span class="at">by =</span> <span class="dv">200000</span>), <span class="cn">Inf</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(mpsz) <span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(hdb_resale_test)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>mlr_res_map <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"MLR_RES"</span>,</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> common_breaks,</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Spectral"</span>,</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Multiple Linear Regression Residuals"</span>,</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>gwrf_res_map <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="st">"GWRF_RES"</span>,</span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> common_breaks,</span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"Spectral"</span>,</span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"GW Random Forest Residuals"</span>,</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.8</span></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(mlr_res_map, gwrf_res_map, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">sync =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "MLR_RES" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Variable(s) "GWRF_RES" contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="take_home_ex03_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The maps highlight the residual patterns for both models. The Multiple Linear Regression (MLR) model shows larger residuals (in red and blue) in certain areas, indicating greater prediction errors. In contrast, the Geographically Weighted Random Forest (GWRF) model displays a more balanced distribution with fewer large residuals, suggesting improved accuracy in capturing local price variations across different regions.</p>
</blockquote>
</section>
</section>
<section id="conclusion" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Conclusion</h1>
<p>In conclusion, this analysis aimed to predict HDB resale prices by incorporating structural and locational factors. By leveraging both traditional regression and spatially-aware machine learning techniques, we examined the influence of geographic and property-specific variables on housing prices in Singapore.</p>
<p>Data preprocessing focused on engineering structural and locational factors and calculating proximity metrics for key amenities such as MRT stations, childcare centers, and primary schools. We also accounted for spatial autocorrelation, which revealed clustering in the residuals, validating our choice to incorporate a geographically weighted approach.</p>
<p>The Multiple Linear Regression (MLR) model provided a useful baseline for understanding the relationships between independent variables and resale prices. However, the MLR model struggled with capturing localized price variations, leading to larger residuals in areas with unique market characteristics. In contrast, the Geographically Weighted Random Forest (GWRF) model, which used adaptive bandwidths to account for geographic influences, showed a lower RMSE on the test set and a more balanced residual distribution across regions. This outcome demonstrates the GWRF model’s ability to adapt to spatial variations, resulting in greater accuracy by acknowledging that price drivers vary by location.</p>
<p>It is worth noting that additional factors may influence flat prices but were not included in this study. External variables such as government housing policies, economic conditions, interest rates, and demographic shifts could also play significant roles in shaping resale prices. Future models that incorporate these broader market and policy factors may yield even greater accuracy.</p>
<p>In summary, this study demonstrates the value of incorporating geographic factors into predictive models for housing prices. The GWRF model’s performance suggests that spatially weighted approaches can enhance model accuracy, particularly in geographically diverse markets like Singapore’s.</p>
</section>
<section id="reference" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Reference</h1>
<ul>
<li><p>Housing &amp; Development Board. (n.d.). <em>How BTO Flats are Priced</em>. Retrieved from <a href="https://www.hdb.gov.sg/cs/infoweb/about-us/news-and-publications/publications/hdbspeaks/How-BTO-Flats-are-Priced" class="uri">https://www.hdb.gov.sg/cs/infoweb/about-us/news-and-publications/publications/hdbspeaks/How-BTO-Flats-are-Priced</a></p></li>
<li><p>Megan Sim’s IS415 Take-Home Exercise 3. (October 2021). In <em>IS415-GAA</em>. Retrieved from <a href="https://is415-msty.netlify.app/posts/2021-10-25-take-home-exercise-3/" class="uri">https://is415-msty.netlify.app/posts/2021-10-25-take-home-exercise-3/</a></p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>